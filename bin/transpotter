#!/usr/bin/env ruby

ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../Gemfile', __dir__)

require 'bundler/setup'
require 'thor'
require 'dotenv'

module Transpotter
  class CLI < Thor
    include Thor::Actions

    desc 'relay FROM TO', 'Relay file to S3.'
    option :environment, default: 'production', type: :string, aliases: :e
    def relay(from, to)
      Dotenv.load('.env.local', ".env.#{options[:environment]}", '.env')
      run "aws s3 cp #{from} s3://#{ENV['TRANSPOTTER_S3_BUCKET']}/#{to}"
      run "rm -f #{from}"
    end
  end
end

Transpotter::CLI.start(ARGV)
